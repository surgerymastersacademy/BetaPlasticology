<!DOCTYPE html>
<html lang="en" dir="ltr" class="light"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Plasticology Ultimate Edition</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e293b">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://pub-fb0d46cb77cb4e22b5863540fe118da4.r2.dev/Plasticology%202025%20Logo%20white%20outline.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-100 text-slate-800">

    <canvas id="login-canvas"></canvas>

    <div id="settings-container">
        <button id="toggle-animation-btn" title="Toggle Animation">
            <i class="fas fa-play-circle animation-on-icon"></i>
            <i class="fas fa-pause-circle animation-off-icon"></i>
        </button>
        <button id="toggle-theme-btn" title="Toggle Theme">
            <i class="fas fa-sun sun-icon"></i>
            <i class="fas fa-moon moon-icon"></i>
        </button>
    </div>

    <div id="login-wrapper" class="flex items-center justify-center min-h-screen p-4 transition-all duration-500">
        <div id="login-container" class="w-full max-w-sm mx-auto z-10">
             <div class="login-card p-8 rounded-2xl shadow-2xl">
                <img id="login-logo" src="https://pub-fb0d46cb77cb4e22b5863540fe118da4.r2.dev/Plasticology%202025%20Logo%20white%20outline.png" alt="Logo" class="h-20 mx-auto mb-4">
                <div class="text-center mb-8">
                    <h1 class="text-2xl font-bold text-slate-800">Welcome To Plasticology</h1>
                    <p class="text-slate-500 mt-1">The Ultimate Plastic Surgery Hub</p>
                </div>

                <div id="pwa-install-banner" class="hidden mb-6 p-4 bg-indigo-50 border border-indigo-100 rounded-xl text-center shadow-sm">
                    <div class="flex justify-center mb-2 text-indigo-600 text-3xl">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3 class="font-bold text-indigo-900 text-sm">Get the App</h3>
                    <p class="text-xs text-indigo-700 mb-3">Install for fullscreen & offline access.</p>
                    <button id="pwa-install-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition-colors text-sm shadow-md">
                        Install App
                    </button>
                </div>
                <div id="login-loader" class="loader hidden"></div>
                <p id="login-loading-text" class="text-center text-slate-500 hidden">Loading resources...</p>
                <form id="login-form" class="space-y-6">
                    <div class="input-with-icon-container">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="username" autocomplete="off" class="input-with-icon shadow-sm appearance-none border rounded-lg w-full py-3 px-3 text-slate-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Username" required>
                    </div>
                    <div class="input-with-icon-container">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="password" autocomplete="off" class="input-with-icon shadow-sm appearance-none border rounded-lg w-full py-3 px-3 text-slate-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Password" required>
                    </div>
                    <p id="login-error" class="text-red-500 text-xs italic !mt-2 hidden">Invalid credentials.</p>
                    <button type="submit" id="login-submit-btn" class="action-btn w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:shadow-outline text-lg">
                        Log In
                    </button>
                </form>
                <p class="text-center mt-4">
                    <a href="#" id="show-register-link" class="text-sm text-blue-600 hover:underline">No account? Register Free Trial</a>
                </p>
                <div class="relative flex py-5 items-center">
                    <div class="flex-grow border-t border-gray-300"></div>
                    <span class="flex-shrink mx-4 text-gray-400 text-sm">OR</span>
                    <div class="flex-grow border-t border-gray-300"></div>
                </div>
                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-3">
                        <button type="button" id="free-test-btn" class="w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-3 px-4 rounded-lg flex items-center justify-center transition-colors shadow-sm">
                            <i class="fas fa-vial fa-fw mr-2"></i>
                            <span>Free Test</span>
                        </button>
                        <a href="https://www.youtube.com/playlist?list=PLVUDV5bqFz4jabLMYet03YmJknm8jA-wG" target="_blank" class="w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold py-3 px-4 rounded-lg flex items-center justify-center transition-colors shadow-sm">
                            <i class="fab fa-youtube fa-fw mr-2"></i>
                            <span>Samples</span>
                        </a>
                    </div>
                    <a href="https://plasticologybundles.surgerymastersacademy.com/" target="_blank" class="w-full bg-blue-50 hover:bg-blue-100 text-blue-800 font-semibold py-3 px-4 rounded-lg flex items-center justify-center transition-colors shadow-sm border border-blue-200">
                        <i class="fas fa-tags fa-fw mr-2"></i>
                        <span>View Plans & Pricing</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div id="app-layout" class="hidden h-screen flex overflow-hidden bg-slate-100">
        
        <aside id="sidebar" class="bg-slate-900 text-white w-64 flex-shrink-0 hidden md:flex flex-col transition-all duration-300">
            <div class="p-6 flex items-center justify-center border-b border-slate-700">
                <img src="https://pub-fb0d46cb77cb4e22b5863540fe118da4.r2.dev/Plasticology%202025%20Logo%20white%20outline.png" alt="Logo" class="h-12">
            </div>
            
            <div class="p-4 border-b border-slate-700 flex items-center gap-3">
                <img id="header-user-avatar" src="https://api.dicebear.com/7.x/initials/svg?seed=User" class="w-10 h-10 rounded-full border-2 border-blue-500">
                <div class="overflow-hidden">
                    <p id="user-name-display" class="font-bold text-sm truncate">User Name</p>
                    <button id="user-profile-header-btn" class="text-xs text-blue-400 hover:text-blue-300">View Profile</button>
                </div>
            </div>

            <nav class="flex-1 overflow-y-auto py-4 px-2 space-y-1 custom-scrollbar">
                <button id="global-home-btn" class="sidebar-link active w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-home w-6 text-center"></i> Dashboard
                </button>
                <button id="lectures-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-video w-6 text-center text-teal-400"></i> Lectures
                </button>
                <button id="qbank-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-question-circle w-6 text-center text-indigo-400"></i> Q-Bank
                </button>
                <button id="learning-mode-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-book-reader w-6 text-center text-green-400"></i> Learning Mode
                </button>
                <button id="theory-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-book-medical w-6 text-center text-yellow-400"></i> Theory & Essay
                </button>
                <button id="osce-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-user-md w-6 text-center text-sky-400"></i> OSCE Bank
                </button>
                 <button id="matching-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-puzzle-piece w-6 text-center text-pink-400"></i> Matching
                </button>
                <button id="study-planner-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-calendar-alt w-6 text-center text-purple-400"></i> Study Planner
                </button>
                <div class="border-t border-slate-700 my-2"></div>
                <button id="library-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-book-bookmark w-6 text-center"></i> Library
                </button>
                <button id="leaderboard-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-trophy w-6 text-center"></i> Leaderboard
                </button>
                <button id="messenger-btn" class="sidebar-link w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 hover:bg-slate-800 transition">
                    <i class="fas fa-comments w-6 text-center"></i> Messenger
                </button>
            </nav>

            <div class="p-4 border-t border-slate-700">
                <button id="logout-btn" class="w-full py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition flex items-center justify-center gap-2 font-bold">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </aside>

        <div class="flex-1 flex flex-col h-screen overflow-hidden relative">
            
            <header id="global-header" class="bg-white h-16 flex items-center justify-between px-4 shadow-sm z-20 flex-shrink-0">
                <div class="flex items-center gap-3 md:hidden">
                    <img src="https://pub-fb0d46cb77cb4e22b5863540fe118da4.r2.dev/Plasticology%202025%20Logo%20white%20outline.png" alt="Logo" class="h-8" style="filter: invert(1);">
                </div>
                
                <div class="hidden md:block font-bold text-xl text-slate-700">Plasticology Dashboard</div>

                <div class="flex items-center gap-3">
                    <div id="streak-container" class="hidden flex items-center bg-orange-100 text-orange-600 px-3 py-1 rounded-full font-bold text-sm border border-orange-200 cursor-pointer" title="Daily Streak">
                        <i class="fas fa-fire mr-1.5"></i>
                        <span id="streak-count">0</span>
                    </div>
                    
                    <button id="radio-btn" class="w-9 h-9 rounded-full bg-slate-100 hover:bg-slate-200 text-slate-600 flex items-center justify-center transition" title="Radio"><i class="fas fa-broadcast-tower"></i></button>
                    <button id="announcements-btn" class="w-9 h-9 rounded-full bg-slate-100 hover:bg-slate-200 text-slate-600 flex items-center justify-center transition" title="News"><i class="fas fa-bullhorn"></i></button>
                    <button id="notes-btn" class="w-9 h-9 rounded-full bg-slate-100 hover:bg-slate-200 text-slate-600 flex items-center justify-center transition" title="My Notes"><i class="fas fa-sticky-note"></i></button>
                    <button id="activity-log-btn" class="w-9 h-9 rounded-full bg-slate-100 hover:bg-slate-200 text-slate-600 flex items-center justify-center transition" title="History"><i class="fas fa-history"></i></button>
                    <button id="help-btn" class="w-9 h-9 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 flex items-center justify-center transition md:hidden" title="Help"><i class="fas fa-question"></i></button>
                </div>
            </header>

            <div id="radio-banner-container" class="max-h-0 overflow-hidden transition-all duration-500 ease-in-out bg-slate-800 shrink-0">
                <div class="p-2 flex justify-between items-center text-white">
                    <span class="font-bold text-sm ml-2"><i class="fas fa-music mr-2"></i>Plasticology Radio</span>
                    <button id="radio-close-btn" class="hover:text-red-400 px-2">&times;</button>
                </div>
                <iframe src="https://plasticologyradio.surgerymastersacademy.com/" class="w-full h-40 border-0"></iframe>
            </div>

            <main id="main-content" class="flex-1 overflow-y-auto bg-slate-50 p-4 md:p-8 pb-24 md:pb-8 relative">
                <div id="watermark-overlay" class="hidden"></div>
                
                <div id="main-menu-container" class="w-full hidden max-w-6xl mx-auto">
                    <div id="announcement-banner" class="hidden mb-4"></div>
                    
                    <div class="bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl p-6 md:p-8 text-white shadow-lg mb-8 relative overflow-hidden">
                        <div class="absolute top-0 right-0 -mt-4 -mr-4 bg-white opacity-10 w-32 h-32 rounded-full blur-2xl"></div>
                        <div class="relative z-10">
                            <h2 class="text-2xl md:text-3xl font-bold mb-2">Welcome back, Surgeon!</h2>
                            <p class="text-blue-100 mb-6 max-w-xl">Ready to master Plastic Surgery today? Pick up where you left off or start a new challenge.</p>
                            
                            <div id="last-activity-container" class="flex flex-wrap gap-3">
                                <div id="last-lecture-ribbon" class="hidden bg-white/20 backdrop-blur-sm border border-white/30 px-4 py-2 rounded-lg text-sm font-medium hover:bg-white/30 transition cursor-pointer"></div>
                                <div id="last-quiz-ribbon" class="hidden bg-white/20 backdrop-blur-sm border border-white/30 px-4 py-2 rounded-lg text-sm font-medium hover:bg-white/30 transition cursor-pointer"></div>
                            </div>
                        </div>
                    </div>

                    <h3 class="text-lg font-bold text-slate-700 mb-4 px-1">Study Modules</h3>
                    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 mb-8">
                        <button onclick="document.getElementById('lectures-btn').click()" class="dashboard-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition border border-slate-100 flex flex-col items-center justify-center text-center h-32 md:hidden">
                            <div class="w-12 h-12 rounded-full bg-teal-50 text-teal-600 flex items-center justify-center text-2xl mb-3"><i class="fas fa-video"></i></div>
                            <span class="font-bold text-slate-700 text-sm">Lectures</span>
                        </button>
                        <button onclick="document.getElementById('qbank-btn').click()" class="dashboard-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition border border-slate-100 flex flex-col items-center justify-center text-center h-32 md:hidden">
                            <div class="w-12 h-12 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center text-2xl mb-3"><i class="fas fa-question-circle"></i></div>
                            <span class="font-bold text-slate-700 text-sm">Q-Bank</span>
                        </button>
                        <button onclick="document.getElementById('osce-btn').click()" class="dashboard-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition border border-slate-100 flex flex-col items-center justify-center text-center h-32 md:hidden">
                            <div class="w-12 h-12 rounded-full bg-sky-50 text-sky-600 flex items-center justify-center text-2xl mb-3"><i class="fas fa-user-md"></i></div>
                            <span class="font-bold text-slate-700 text-sm">OSCE</span>
                        </button>
                         <button onclick="document.getElementById('theory-btn').click()" class="dashboard-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition border border-slate-100 flex flex-col items-center justify-center text-center h-32 md:hidden">
                            <div class="w-12 h-12 rounded-full bg-yellow-50 text-yellow-600 flex items-center justify-center text-2xl mb-3"><i class="fas fa-book-medical"></i></div>
                            <span class="font-bold text-slate-700 text-sm">Theory</span>
                        </button>
                        
                        <button onclick="document.getElementById('matching-btn').click()" class="dashboard-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition border border-slate-100 flex flex-col items-center justify-center text-center h-32">
                            <div class="w-12 h-12 rounded-full bg-pink-50 text-pink-600 flex items-center justify-center text-2xl mb-3"><i class="fas fa-puzzle-piece"></i></div>
                            <span class="font-bold text-slate-700 text-sm">Matching</span>
                        </button>
                         <button onclick="document.getElementById('learning-mode-btn').click()" class="dashboard-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition border border-slate-100 flex flex-col items-center justify-center text-center h-32 md:hidden">
                            <div class="w-12 h-12 rounded-full bg-green-50 text-green-600 flex items-center justify-center text-2xl mb-3"><i class="fas fa-book-reader"></i></div>
                            <span class="font-bold text-slate-700 text-sm">Learning</span>
                        </button>
                        <button onclick="document.getElementById('study-planner-btn').click()" class="dashboard-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition border border-slate-100 flex flex-col items-center justify-center text-center h-32">
                            <div class="w-12 h-12 rounded-full bg-purple-50 text-purple-600 flex items-center justify-center text-2xl mb-3"><i class="fas fa-calendar-alt"></i></div>
                            <span class="font-bold text-slate-700 text-sm">Planner</span>
                        </button>
                        <button onclick="document.getElementById('library-btn').click()" class="dashboard-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition border border-slate-100 flex flex-col items-center justify-center text-center h-32">
                            <div class="w-12 h-12 rounded-full bg-orange-50 text-orange-600 flex items-center justify-center text-2xl mb-3"><i class="fas fa-book-bookmark"></i></div>
                            <span class="font-bold text-slate-700 text-sm">Library</span>
                        </button>
                        <button onclick="document.getElementById('leaderboard-btn').click()" class="dashboard-card bg-white p-4 rounded-xl shadow-sm hover:shadow-md transition border border-slate-100 flex flex-col items-center justify-center text-center h-32">
                            <div class="w-12 h-12 rounded-full bg-red-50 text-red-600 flex items-center justify-center text-2xl mb-3"><i class="fas fa-trophy"></i></div>
                            <span class="font-bold text-slate-700 text-sm">Leaders</span>
                        </button>
                    </div>
                </div>

                <div id="lectures-container" class="w-full hidden max-w-4xl mx-auto">
                    <div class="flex items-center justify-between mb-6">
                         <h2 class="text-2xl font-bold text-slate-800">Video Lectures</h2>
                         <button id="lectures-back-btn" class="text-sm font-bold text-slate-500 hover:text-slate-800 md:hidden"><i class="fas fa-arrow-left mr-1"></i> Back</button>
                    </div>
                    <div class="relative mb-6">
                        <input type="text" id="lecture-search-input" placeholder="Search topics..." class="w-full p-3 pl-10 bg-white border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-sm">
                        <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"></i>
                    </div>
                    <div id="lectures-loader" class="loader"></div>
                    <div id="lectures-list" class="space-y-4 pb-20"></div>
                </div>

                <div id="qbank-container" class="w-full hidden max-w-4xl mx-auto">
                     <div class="flex items-center justify-between mb-6">
                         <h2 class="text-2xl font-bold text-slate-800">Question Bank</h2>
                         <button id="qbank-back-btn" class="text-sm font-bold text-slate-500 hover:text-slate-800 md:hidden"><i class="fas fa-arrow-left mr-1"></i> Back</button>
                    </div>
                    
                    <div class="flex space-x-1 bg-slate-200 p-1 rounded-xl mb-6">
                        <button id="qbank-tab-create" class="flex-1 py-2 rounded-lg text-sm font-bold transition bg-white text-slate-800 shadow-sm">Create</button>
                        <button id="qbank-tab-practice" class="flex-1 py-2 rounded-lg text-sm font-bold transition text-slate-600 hover:bg-slate-300/50">Practice</button>
                        <button id="qbank-tab-browse" class="flex-1 py-2 rounded-lg text-sm font-bold transition text-slate-600 hover:bg-slate-300/50">Browse</button>
                    </div>

                    <div id="qbank-main-content">
                        <div id="qbank-panel-create" class="qbank-panel">
                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-6">
                                <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><i class="fas fa-search text-blue-500"></i> Quick Search</h3>
                                <div class="flex gap-2">
                                    <input type="text" id="qbank-search-input" class="flex-1 bg-slate-50 border border-slate-200 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="e.g., Flaps, Burns...">
                                    <button id="qbank-search-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-blue-700">Go</button>
                                </div>
                                <p id="qbank-search-error" class="text-red-500 text-xs mt-2 hidden"></p>
                                <div id="qbank-search-results-container" class="hidden mt-4 p-4 bg-slate-50 rounded-lg">
                                     <p id="qbank-search-results-info" class="mb-2 text-sm font-bold"></p>
                                     <div class="flex gap-2">
                                        <input type="number" id="qbank-search-q-count" placeholder="Qty" class="w-20 p-2 rounded border">
                                        <button id="qbank-start-search-quiz-btn" class="flex-1 bg-green-600 text-white rounded font-bold text-sm">Start</button>
                                        <button id="qbank-clear-search-btn" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times"></i></button>
                                     </div>
                                </div>
                            </div>

                            <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 mb-6">
                                <h3 class="text-lg font-bold text-slate-800 mb-4 flex items-center gap-2"><i class="fas fa-sliders-h text-emerald-500"></i> Custom Exam</h3>
                                <div id="loader" class="loader hidden"></div>
                                <p id="loading-text" class="hidden text-center text-xs text-slate-400">Loading...</p>
                                
                                <div class="grid grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="text-xs font-bold text-slate-500 uppercase">Questions</label>
                                        <input type="number" id="mock-q-count" class="w-full p-2 bg-slate-50 border rounded-lg font-bold" placeholder="10">
                                    </div>
                                    <div>
                                        <label class="text-xs font-bold text-slate-500 uppercase">Time (Sec/Q)</label>
                                        <input type="number" id="custom-timer-input" class="w-full p-2 bg-slate-50 border rounded-lg font-bold" placeholder="60">
                                    </div>
                                </div>

                                <button id="toggle-custom-options-btn" class="w-full py-2 bg-slate-100 text-slate-600 font-bold rounded-lg mb-4 text-sm hover:bg-slate-200">
                                    Filter by Chapter/Source <i class="fas fa-chevron-down ml-1"></i>
                                </button>

                                <div id="custom-exam-options" class="custom-exam-options">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                        <div class="bg-slate-50 p-3 rounded-lg border h-40 overflow-y-auto custom-scrollbar">
                                            <div class="flex items-center justify-between mb-2 border-b pb-1">
                                                <span class="font-bold text-xs uppercase text-slate-500">Sources</span>
                                                <label class="text-xs flex items-center gap-1"><input type="checkbox" id="select-all-sources-mock"> All</label>
                                            </div>
                                            <div id="source-select-mock" class="space-y-1"></div>
                                        </div>
                                        <div class="bg-slate-50 p-3 rounded-lg border h-40 overflow-y-auto custom-scrollbar">
                                            <div class="flex items-center justify-between mb-2 border-b pb-1">
                                                <span class="font-bold text-xs uppercase text-slate-500">Chapters</span>
                                                <label class="text-xs flex items-center gap-1"><input type="checkbox" id="select-all-chapters-mock"> All</label>
                                            </div>
                                            <div id="chapter-select-mock" class="space-y-1"></div>
                                        </div>
                                    </div>
                                </div>

                                <button id="start-mock-btn" class="w-full py-3 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold shadow-md shadow-emerald-200">Start Exam</button>
                                <p id="mock-error" class="text-red-500 text-xs mt-2 hidden text-center"></p>
                            </div>

                            <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-2xl shadow-lg text-white relative overflow-hidden">
                                <div class="relative z-10">
                                    <h3 class="text-lg font-bold mb-2 flex items-center gap-2"><i class="fas fa-stopwatch text-rose-500"></i> Exam Simulation</h3>
                                    <p class="text-slate-400 text-sm mb-4">Real exam conditions. 100 Qs in 120 Mins. No feedback until the end.</p>
                                    
                                    <button id="toggle-simulation-options-btn" class="text-xs bg-slate-700 hover:bg-slate-600 px-3 py-1 rounded-full mb-4 transition">
                                        <i class="fas fa-filter mr-1"></i> Customize Scope
                                    </button>

                                    <div id="simulation-custom-options" class="hidden mb-4 bg-slate-800/50 p-4 rounded-lg border border-slate-700">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <div class="flex items-center justify-between mb-1">
                                                    <span class="text-xs font-bold text-slate-500">SOURCES</span>
                                                    <label class="text-xs"><input type="checkbox" id="select-all-sources-sim" checked> All</label>
                                                </div>
                                                <div id="source-select-sim" class="h-32 overflow-y-auto custom-scrollbar bg-slate-900/50 p-2 rounded border border-slate-700 text-sm"></div>
                                            </div>
                                            <div>
                                                <div class="flex items-center justify-between mb-1">
                                                    <span class="text-xs font-bold text-slate-500">CHAPTERS</span>
                                                    <label class="text-xs"><input type="checkbox" id="select-all-chapters-sim" checked> All</label>
                                                </div>
                                                <div id="chapter-select-sim" class="h-32 overflow-y-auto custom-scrollbar bg-slate-900/50 p-2 rounded border border-slate-700 text-sm"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <button id="start-simulation-btn" class="w-full py-3 bg-rose-600 hover:bg-rose-700 text-white rounded-xl font-bold shadow-lg shadow-rose-900/20">Start Simulation</button>
                                    <p id="simulation-error" class="text-red-400 text-xs mt-2 hidden"></p>
                                </div>
                            </div>
                        </div>

                        <div id="qbank-panel-practice" class="qbank-panel hidden">
                            <div class="grid grid-cols-1 gap-4">
                                <button id="practice-mistakes-btn" class="p-6 bg-orange-100 text-orange-800 rounded-xl font-bold text-left hover:bg-orange-200 transition flex items-center justify-between">
                                    <span><i class="fas fa-bug mr-2"></i> Practice Mistakes</span>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                                <button id="practice-bookmarked-btn" class="p-6 bg-blue-100 text-blue-800 rounded-xl font-bold text-left hover:bg-blue-200 transition flex items-center justify-between">
                                    <span><i class="fas fa-bookmark mr-2"></i> Practice Bookmarked</span>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>

                        <div id="qbank-panel-browse" class="qbank-panel hidden">
                             <div class="grid grid-cols-1 gap-4">
                                <button id="browse-by-chapter-btn" class="p-6 bg-white border border-slate-200 text-slate-700 rounded-xl font-bold text-left hover:bg-slate-50 transition flex items-center justify-between">
                                    <span><i class="fas fa-list mr-2"></i> Browse by Chapter</span>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                                <button id="browse-by-source-btn" class="p-6 bg-white border border-slate-200 text-slate-700 rounded-xl font-bold text-left hover:bg-slate-50 transition flex items-center justify-between">
                                    <span><i class="fas fa-book mr-2"></i> Browse by Source</span>
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="quiz-container" class="w-full hidden h-full flex flex-col">
                     <div class="bg-white p-4 border-b flex items-center justify-between sticky top-0 z-10 shadow-sm rounded-t-xl">
                        <div class="flex items-center gap-3">
                            <button id="end-quiz-btn" class="text-slate-400 hover:text-red-500 text-xl"><i class="fas fa-times-circle"></i></button>
                            <div id="timer" class="font-mono font-bold bg-slate-100 px-2 py-1 rounded text-slate-700">00:00</div>
                        </div>
                        <h2 id="quiz-title" class="font-bold text-sm md:text-base truncate max-w-[150px] md:max-w-md text-center">Quiz</h2>
                        <div class="flex items-center gap-2">
                            <button id="navigator-btn" class="text-slate-500 hover:text-blue-600"><i class="fas fa-th"></i></button>
                            <button id="quiz-note-btn" class="text-slate-500 hover:text-amber-500 note-icon"><i class="fas fa-sticky-note"></i></button>
                        </div>
                    </div>
                    
                    <div class="w-full bg-slate-200 h-1.5">
                        <div class="flex h-full">
                            <div id="score-bar-correct" class="bg-emerald-500 h-full" style="width: 0%"></div>
                            <div id="score-bar-incorrect" class="bg-red-500 h-full" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="flex-1 overflow-y-auto p-4 md:p-8 bg-white">
                         <div class="max-w-3xl mx-auto">
                            <div class="flex justify-between text-xs text-slate-400 mb-4 font-medium">
                                <span id="progress-text">Q 1/10</span>
                                <span id="source-text">Source: Unknown</span>
                            </div>
                            
                            <div id="question-image-container" class="mb-6 flex justify-center"></div>
                            
                            <h3 id="question-text" class="text-lg md:text-xl font-bold text-slate-800 mb-8 leading-relaxed"></h3>
                            
                            <div id="answer-buttons-quiz" class="grid grid-cols-1 gap-3"></div>
                            
                            <div id="hint-text" class="hidden mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 text-sm rounded"></div>
                        </div>
                    </div>

                    <div id="controls-container" class="bg-slate-50 p-4 border-t flex items-center justify-between sticky bottom-0 z-10 rounded-b-xl">
                        <div class="flex gap-3">
                             <button id="previous-btn" class="w-10 h-10 rounded-full bg-white border border-slate-200 text-slate-600 flex items-center justify-center hover:bg-slate-100 shadow-sm"><i class="fas fa-chevron-left"></i></button>
                             <button id="bookmark-btn" class="w-10 h-10 rounded-full bg-white border border-slate-200 text-slate-400 flex items-center justify-center hover:text-blue-500 shadow-sm bookmark-btn"><i class="far fa-bookmark"></i></button>
                             <button id="flag-btn" class="w-10 h-10 rounded-full bg-white border border-slate-200 text-slate-400 flex items-center justify-center hover:text-amber-500 shadow-sm flag-btn"><i class="far fa-flag"></i></button>
                             <button id="hint-btn" class="w-10 h-10 rounded-full bg-white border border-slate-200 text-slate-400 flex items-center justify-center hover:text-yellow-500 shadow-sm"><i class="far fa-lightbulb"></i></button>
                        </div>
                        <button id="next-skip-btn" class="px-6 py-2 bg-blue-600 text-white font-bold rounded-lg shadow-md hover:bg-blue-700 flex items-center gap-2">
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>

                    <div id="results-container" class="hidden absolute inset-0 bg-white z-20 flex flex-col items-center justify-center p-8">
                        <i class="fas fa-clipboard-check text-6xl text-blue-500 mb-4"></i>
                        <h2 id="results-title" class="text-2xl font-bold text-slate-800 mb-2">Quiz Complete!</h2>
                        <p class="text-slate-600 mb-8">You scored <span id="score-text" class="font-bold text-slate-900 text-xl">0</span> / <span id="total-questions">0</span></p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 w-full max-w-md">
                            <button id="review-incorrect-btn" class="hidden py-3 bg-red-100 text-red-700 font-bold rounded-lg hover:bg-red-200">Review Mistakes</button>
                            <button id="review-simulation-btn" class="hidden py-3 bg-blue-100 text-blue-700 font-bold rounded-lg hover:bg-blue-200">Review All</button>
                            <button id="restart-btn" class="py-3 bg-slate-100 text-slate-700 font-bold rounded-lg hover:bg-slate-200">Restart</button>
                            <button id="results-home-btn" class="py-3 bg-slate-800 text-white font-bold rounded-lg hover:bg-slate-900">Back to Dashboard</button>
                        </div>
                    </div>
                </div>

                <div id="osce-container" class="w-full hidden max-w-4xl mx-auto">
                    <div class="flex items-center justify-between mb-6">
                         <h2 class="text-2xl font-bold text-slate-800">OSCE Station</h2>
                         <button id="osce-back-btn" class="text-sm font-bold text-slate-500 hover:text-slate-800 md:hidden"><i class="fas fa-arrow-left mr-1"></i> Back</button>
                    </div>
                    
                    <div id="osce-controls">
                        <div class="bg-white p-8 rounded-2xl shadow-sm text-center mb-6">
                            <h3 class="text-xl font-bold mb-2">OSCE Slayer</h3>
                            <p class="text-slate-500 mb-6">Rapid fire clinical cases.</p>
                            <button id="start-osce-slayer-btn" class="bg-rose-600 text-white px-8 py-3 rounded-xl font-bold hover:bg-rose-700 shadow-lg shadow-rose-200">Start Slayer Mode</button>
                        </div>
                        
                        <div class="bg-slate-50 p-6 rounded-2xl border border-slate-200">
                             <h3 class="font-bold text-slate-700 mb-4">Custom Session</h3>
                             <div class="grid grid-cols-2 gap-4 mb-4">
                                 <input type="number" id="osce-case-count" placeholder="# Cases" class="p-2 rounded border">
                                 <input type="number" id="osce-time-per-q" placeholder="Min/Q" class="p-2 rounded border">
                             </div>
                             <button id="toggle-osce-options-btn" class="text-sm text-blue-600 font-bold mb-4">Filters +</button>
                             <div id="custom-osce-options" class="hidden mb-4">
                                 <div class="grid grid-cols-2 gap-4">
                                     <div id="chapter-select-osce" class="bg-white p-2 h-32 overflow-y-auto border rounded"></div>
                                     <div id="source-select-osce" class="bg-white p-2 h-32 overflow-y-auto border rounded"></div>
                                 </div>
                             </div>
                             <button id="start-custom-osce-btn" class="w-full bg-sky-600 text-white py-3 rounded-lg font-bold hover:bg-sky-700">Start Custom OSCE</button>
                             <p id="osce-error" class="text-red-500 text-xs mt-2 hidden"></p>
                        </div>
                    </div>
                </div>
                <div id="osce-quiz-container" class="hidden w-full h-full flex flex-col bg-slate-100">
                     <div class="p-4 bg-white border-b flex justify-between items-center">
                        <button id="end-osce-quiz-btn" class="text-red-500 font-bold">Exit</button>
                        <h2 id="osce-quiz-title" class="font-bold text-slate-800">OSCE</h2>
                        <div class="flex gap-2">
                            <span id="osce-timer" class="font-mono bg-slate-100 px-2 rounded">00:00</span>
                            <span id="osce-score" class="font-mono bg-blue-100 text-blue-800 px-2 rounded">0/0</span>
                        </div>
                    </div>
                    <div class="flex-1 p-4 overflow-y-auto">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 h-full">
                            <div class="bg-white p-4 rounded-xl shadow-sm flex flex-col">
                                <h3 id="osce-case-title" class="font-bold text-lg mb-2"></h3>
                                <div id="osce-case-image-container" class="flex-1 flex items-center justify-center bg-slate-50 rounded mb-2"></div>
                                <p id="osce-case-description" class="text-sm text-slate-600 mt-2"></p>
                            </div>
                            <div class="flex flex-col">
                                <p id="osce-progress-text" class="text-center text-xs text-slate-400 mb-2"></p>
                                <div class="bg-white p-6 rounded-xl shadow-sm flex-1 flex flex-col">
                                    <div id="osce-question-image-container" class="mb-4"></div>
                                    <h3 id="osce-question-text" class="font-bold text-lg mb-4"></h3>
                                    <div id="osce-answer-area" class="space-y-2 flex-1"></div>
                                    
                                    <div id="osce-model-answer-area" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded"></div>
                                    <div id="osce-self-correction-area" class="hidden mt-4"></div>

                                    <div class="flex justify-between mt-6 pt-4 border-t">
                                        <button id="osce-previous-btn" class="px-4 py-2 bg-slate-100 rounded font-bold hover:bg-slate-200">Prev</button>
                                        <button id="osce-navigator-btn" class="text-slate-400 hover:text-blue-600"><i class="fas fa-th"></i></button>
                                        <button id="osce-next-btn" class="px-6 py-2 bg-blue-600 text-white rounded font-bold hover:bg-blue-700">Next</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="matching-container" class="w-full hidden max-w-4xl mx-auto">
                     <div id="matching-menu-container">
                        <div class="flex items-center justify-between mb-6">
                             <h2 class="text-2xl font-bold text-slate-800">Matching Bank</h2>
                             <button id="matching-back-btn" class="md:hidden text-slate-500 font-bold">Back</button>
                        </div>
                        <div class="bg-white p-6 rounded-2xl shadow-sm">
                             <div class="grid grid-cols-2 gap-4 mb-4">
                                 <div><label class="text-xs font-bold">Sets</label><input type="number" id="matching-set-count" class="w-full border rounded p-2" placeholder="10"></div>
                                 <div><label class="text-xs font-bold">Time (Sec)</label><input type="number" id="matching-timer-input" class="w-full border rounded p-2" placeholder="60"></div>
                             </div>
                             <details class="mb-6 border rounded p-2">
                                 <summary class="cursor-pointer font-bold text-sm text-slate-600">Filters</summary>
                                 <div class="grid grid-cols-2 gap-4 mt-2">
                                     <div id="chapter-select-matching" class="h-32 overflow-y-auto bg-slate-50 p-2"></div>
                                     <div id="source-select-matching" class="h-32 overflow-y-auto bg-slate-50 p-2"></div>
                                 </div>
                             </details>
                             <button id="start-matching-btn" class="w-full bg-pink-600 text-white py-3 rounded-xl font-bold shadow-md shadow-pink-200">Start Matching</button>
                             <p id="matching-error" class="text-red-500 text-center text-xs mt-2"></p>
                        </div>
                     </div>
                     <div id="matching-game-container" class="hidden h-full flex flex-col">
                         <div class="flex justify-between items-center bg-white p-4 rounded-xl mb-4 shadow-sm">
                             <button id="end-matching-btn" class="text-red-500"><i class="fas fa-stop-circle"></i></button>
                             <span id="matching-progress" class="font-bold">Set 1/10</span>
                             <span id="matching-timer" class="font-mono bg-slate-100 px-2 rounded">00:00</span>
                             <span id="matching-score" class="text-blue-600 font-bold">0</span>
                         </div>
                         <div class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-6">
                             <div id="matching-premises-area" class="space-y-2"></div>
                             <div id="matching-answers-area" class="space-y-2"></div>
                         </div>
                         <div class="mt-4 flex justify-end gap-4">
                             <button id="matching-submit-btn" class="px-6 py-2 bg-green-600 text-white rounded font-bold">Check</button>
                             <button id="matching-next-btn" class="hidden px-6 py-2 bg-blue-600 text-white rounded font-bold">Next Set</button>
                         </div>
                     </div>
                </div>

                <div id="library-container" class="hidden"><button id="library-back-btn" class="mb-4 md:hidden">Back</button><div id="library-loader"></div><div id="library-list" class="grid grid-cols-1 gap-4"></div></div>
                <div id="leaderboard-container" class="hidden"><button id="leaderboard-back-btn" class="mb-4 md:hidden">Back</button><div id="leaderboard-loader"></div><div id="current-user-rank"></div><div id="leaderboard-list"></div></div>
                <div id="study-planner-container" class="hidden"><button id="study-planner-back-btn" class="mb-4 md:hidden">Back</button><div id="planner-dashboard">
                    <div class="flex justify-between mb-4"><h3 class="font-bold">My Plans</h3><button id="show-create-plan-modal-btn" class="bg-blue-500 text-white px-3 rounded text-sm">New</button></div>
                    <div id="study-plans-list"></div>
                    <details id="performance-insights-container" class="mt-6 bg-white p-4 rounded"><summary>Insights</summary><ul id="strengths-list"></ul><ul id="weaknesses-list"></ul></details>
                </div>
                <div id="active-plan-view" class="hidden">
                     <button id="back-to-plans-dashboard-btn">Back</button>
                     <h3 id="active-plan-name"></h3>
                     <p id="plan-days-remaining"></p><p id="plan-tasks-today"></p><div id="plan-progress-bar"></div>
                     <div id="study-plan-days-container"></div>
                </div><div id="study-planner-loader"></div></div>
                <div id="learning-mode-container" class="hidden">
                    <button id="learning-mode-back-btn" class="mb-4 md:hidden">Back</button>
                    <div id="learning-mode-controls">
                        <div class="flex gap-2 mb-4"><input id="learning-search-input" class="border p-2 flex-1"><button id="learning-search-btn" class="bg-blue-500 text-white px-4">Search</button></div><p id="learning-search-error" class="hidden"></p>
                        <button id="learning-browse-by-chapter-btn" class="block w-full bg-white p-4 mb-2 rounded">By Chapter</button>
                        <button id="learning-browse-by-source-btn" class="block w-full bg-white p-4 mb-2 rounded">By Source</button>
                        <button id="learning-mistakes-btn" class="block w-full bg-orange-100 p-4 mb-2 rounded">Mistakes</button>
                        <button id="learning-bookmarked-btn" class="block w-full bg-blue-100 p-4 mb-2 rounded">Bookmarks</button>
                    </div>
                    <div id="learning-mode-viewer" class="hidden">
                         <div class="flex justify-between mb-4"><button id="end-learning-btn">End</button><h2 id="learning-title"></h2></div>
                         <p id="learning-progress-text"></p><p id="learning-source-text"></p>
                         <div id="learning-image-container"></div><h2 id="learning-question-text"></h2>
                         <div id="learning-answer-buttons"></div>
                         <div class="flex justify-between mt-4"><button id="learning-previous-btn">Prev</button><button id="learning-next-btn">Next</button></div>
                    </div>
                </div>
                <div id="theory-container" class="hidden">
                     <button id="theory-back-btn" class="mb-4 md:hidden">Back</button>
                     <div id="theory-controls">
                         <div class="flex gap-2 mb-4"><input id="theory-search-input" class="border p-2 flex-1"><button id="theory-search-btn">Search</button></div>
                         <button id="theory-flashcard-mode-btn" class="block w-full bg-yellow-500 text-white p-4 mb-2 rounded">Flashcards</button>
                         <button id="theory-exam-mode-btn" class="block w-full bg-orange-500 text-white p-4 mb-2 rounded">Exam Mode</button>
                         <button id="theory-browse-by-chapter-btn" class="block w-full bg-white p-4 mb-2 rounded">Chapter</button>
                         <button id="theory-browse-by-source-btn" class="block w-full bg-white p-4 mb-2 rounded">Source</button>
                     </div>
                     <div id="theory-viewer" class="hidden">
                         <div class="flex justify-between mb-4"><button id="theory-end-btn">End</button><h2 id="theory-title"></h2><span id="theory-timer"></span></div>
                         <p id="theory-progress-text"></p><p id="theory-source-text"></p>
                         <div id="theory-img-container"></div><h3 id="theory-question-text"></h3>
                         <div id="theory-answer-container" class="hidden"><p id="theory-answer-text"></p></div>
                         <button id="theory-show-answer-btn" class="mt-4 bg-blue-500 text-white px-4 py-2">Show Answer</button>
                         <div class="flex justify-between mt-4">
                             <button id="theory-prev-btn">Prev</button>
                             <div class="flex gap-2"><button id="theory-note-btn"><i class="fas fa-sticky-note"></i></button><button id="theory-status-btn"><i class="fas fa-check"></i></button></div>
                             <button id="theory-next-btn">Next</button>
                         </div>
                     </div>
                </div>
                <div id="list-container" class="hidden"><button id="list-back-btn" class="mb-4 md:hidden">Back</button><h2 id="list-title"></h2><div id="list-items"></div></div>
                <div id="notes-container" class="hidden"><button id="notes-back-btn" class="mb-4 md:hidden">Back</button><div class="flex gap-2 mb-4"><button id="notes-filter-quizzes">Quiz</button><button id="notes-filter-lectures">Lec</button><button id="notes-filter-theory">Theory</button></div><div id="notes-list"></div></div>
                <div id="activity-log-container" class="hidden"><button id="activity-back-btn" class="mb-4 md:hidden">Back</button><button id="clear-log-btn" class="float-right text-red-500">Clear</button>
                    <div class="flex gap-2 mb-4"><button id="log-filter-all">All</button><button id="log-filter-quizzes">Quiz</button><button id="log-filter-lectures">Lec</button></div>
                    <canvas id="activity-chart" height="100"></canvas>
                    <div id="all-summary" class="hidden grid grid-cols-2 gap-2 mb-4"><div id="all-lectures-progress"></div><div id="all-questions-progress"></div></div>
                    <div id="quiz-summary" class="hidden grid grid-cols-3 gap-2 mb-4"><div id="total-correct-answers"></div><div id="total-incorrect-answers"></div><div id="overall-accuracy"></div></div>
                    <div id="lecture-summary" class="hidden grid grid-cols-2 gap-2 mb-4"><div id="lectures-viewed-count"></div><div id="chapters-started-count"></div></div>
                    <div id="activity-log-list"></div>
                </div>

            </main>

            <nav id="bottom-nav" class="md:hidden bg-white border-t border-slate-200 flex justify-around items-center h-16 shrink-0 z-30">
                <button onclick="document.getElementById('global-home-btn').click()" class="flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-blue-600 focus:text-blue-600 active-nav-link">
                    <i class="fas fa-home text-xl mb-1"></i>
                    <span class="text-[10px] font-bold">Home</span>
                </button>
                <button onclick="document.getElementById('lectures-btn').click()" class="flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-blue-600 focus:text-blue-600">
                    <i class="fas fa-video text-xl mb-1"></i>
                    <span class="text-[10px] font-bold">Lectures</span>
                </button>
                <button onclick="document.getElementById('qbank-btn').click()" class="flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-blue-600 focus:text-blue-600">
                    <i class="fas fa-question-circle text-xl mb-1"></i>
                    <span class="text-[10px] font-bold">Q-Bank</span>
                </button>
                <button onclick="document.getElementById('messenger-btn').click()" class="flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-blue-600 focus:text-blue-600">
                    <i class="fas fa-comments text-xl mb-1"></i>
                    <span class="text-[10px] font-bold">Chat</span>
                </button>
                 <button onclick="document.getElementById('user-profile-header-btn').click()" class="flex flex-col items-center justify-center w-full h-full text-slate-400 hover:text-blue-600 focus:text-blue-600">
                    <i class="fas fa-user text-xl mb-1"></i>
                    <span class="text-[10px] font-bold">Profile</span>
                </button>
            </nav>
        </div>
    </div>

    <div id="modal-backdrop" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-40"></div>

    <div id="user-card-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl p-6 shadow-2xl max-w-sm w-full hidden z-50">
        <button id="user-card-close-btn" class="absolute top-3 right-3 text-slate-400 hover:text-slate-600"><i class="fas fa-times text-xl"></i></button>
        <div class="text-center">
            <img id="user-avatar" src="" class="w-24 h-24 rounded-full mx-auto border-4 border-blue-100 mb-4">
            <h3 id="card-user-name" class="font-bold text-xl text-slate-800"></h3>
            <p id="card-user-nickname" class="text-slate-500 text-sm mb-4"></p>
            <button id="edit-profile-btn" class="text-blue-600 text-sm font-bold hover:underline mb-4">Edit Profile</button>
            
            <div id="profile-details-view" class="bg-slate-50 rounded-xl p-4 text-left space-y-2">
                <div class="flex justify-between"><span class="text-xs font-bold text-slate-500">Plan</span><span id="card-subscription-status" class="text-xs font-bold text-indigo-600">--</span></div>
                <div class="flex justify-between"><span class="text-xs font-bold text-slate-500">Expires</span><span id="card-subscription-expiry" class="text-xs text-slate-700">--</span></div>
                <div class="border-t my-2"></div>
                <div class="flex justify-between"><span class="text-xs font-bold text-slate-500">Total Score</span><span id="card-quiz-score" class="text-lg font-bold text-green-600">0</span></div>
                <div class="flex justify-between"><span class="text-xs font-bold text-slate-500">Exam Date</span><span id="card-exam-date" class="text-xs text-slate-700">--</span></div>
                <div class="flex justify-between"><span class="text-xs font-bold text-slate-500">Countdown</span><span id="card-days-left" class="text-xs font-bold text-red-500">--</span></div>
            </div>

            <div id="profile-edit-view" class="hidden text-left">
                 <div class="mb-3"><label class="text-xs font-bold">Nickname</label><input id="edit-nickname" class="w-full border rounded p-2"></div>
                 <div class="mb-3"><label class="text-xs font-bold">Exam Date</label><input type="date" id="edit-exam-date" class="w-full border rounded p-2"></div>
                 <div class="mb-3"><label class="text-xs font-bold">Avatar</label><div id="avatar-selection-grid" class="grid grid-cols-5 gap-2 h-24 overflow-y-auto"></div></div>
                 <p id="profile-edit-error" class="text-red-500 text-xs hidden"></p>
                 <div class="flex gap-2 mt-4">
                     <button id="cancel-edit-profile-btn" class="flex-1 bg-slate-200 text-slate-700 py-2 rounded-lg font-bold">Cancel</button>
                     <button id="save-profile-btn" class="flex-1 bg-blue-600 text-white py-2 rounded-lg font-bold">Save</button>
                 </div>
            </div>
        </div>
    </div>

    <div id="note-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl p-6 shadow-2xl max-w-lg w-full hidden z-50">
        <h3 id="note-modal-title" class="font-bold text-lg mb-4">Add Note</h3>
        <textarea id="note-textarea" class="w-full h-32 border rounded-lg p-3 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Type your thoughts..."></textarea>
        <div class="flex justify-end gap-2 mt-4">
            <button id="note-cancel-btn" class="px-4 py-2 text-slate-500 font-bold hover:bg-slate-100 rounded-lg">Cancel</button>
            <button id="note-save-btn" class="px-6 py-2 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700">Save Note</button>
        </div>
    </div>

    <div id="registration-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl p-6 shadow-2xl max-w-md w-full hidden z-50 max-h-[90vh] overflow-y-auto">
         <h3 class="text-xl font-bold mb-4 text-center">Create Account</h3>
         <form id="registration-form" class="space-y-3">
             <input id="register-name" placeholder="Full Name" class="w-full border rounded p-2" required>
             <input id="register-username" placeholder="Username" class="w-full border rounded p-2" required>
             <input id="register-email" type="email" placeholder="Email" class="w-full border rounded p-2" required>
             <input id="register-mobile" placeholder="Mobile" class="w-full border rounded p-2" required>
             <div class="grid grid-cols-2 gap-2">
                 <input id="register-password" type="password" placeholder="Password" class="w-full border rounded p-2" required>
                 <input id="register-confirm-password" type="password" placeholder="Confirm" class="w-full border rounded p-2" required>
             </div>
             <input id="register-country" placeholder="Country" class="w-full border rounded p-2" required>
             <input id="register-study-type" placeholder="Study Type (Optional)" class="w-full border rounded p-2">
             <label class="text-xs text-slate-500">Exam Date (Optional)</label>
             <input id="register-exam-date" type="date" class="w-full border rounded p-2">
             
             <p id="registration-error" class="text-red-500 text-xs hidden"></p>
             <p id="registration-success" class="text-green-500 text-xs hidden"></p>
             
             <div class="flex gap-2 pt-2">
                 <button type="button" id="register-cancel-btn" class="flex-1 bg-slate-200 py-2 rounded font-bold">Cancel</button>
                 <button type="submit" id="register-submit-btn" class="flex-1 bg-blue-600 text-white py-2 rounded font-bold">Register</button>
             </div>
         </form>
    </div>

    <div id="confirmation-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl p-6 shadow-2xl max-w-sm w-full hidden z-50">
        <h3 id="modal-title" class="font-bold text-lg mb-2">Confirm</h3>
        <p id="modal-text" class="text-slate-600 mb-6">Are you sure?</p>
        <div class="flex justify-end gap-2">
            <button id="modal-cancel-btn" class="px-4 py-2 bg-slate-100 rounded font-bold hover:bg-slate-200">No</button>
            <button id="modal-confirm-btn" class="px-4 py-2 bg-red-600 text-white rounded font-bold hover:bg-red-700">Yes</button>
        </div>
    </div>

    <div id="question-navigator-modal" class="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl p-6 shadow-2xl max-w-lg w-full hidden z-50">
        <h3 class="font-bold mb-4">Question Map</h3>
        <div id="navigator-grid" class="grid grid-cols-5 sm:grid-cols-8 gap-2 max-h-60 overflow-y-auto p-1"></div>
        <button id="navigator-close-btn" class="mt-4 w-full bg-slate-200 py-2 rounded font-bold">Close</button>
    </div>

    <div id="image-viewer-modal" class="fixed inset-0 z-50 bg-black flex items-center justify-center hidden">
        <button id="image-viewer-close-btn" class="absolute top-4 right-4 text-white text-3xl">&times;</button>
        <img id="modal-image" src="" class="max-w-full max-h-full object-contain">
    </div>

    <div id="clear-log-modal" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded shadow-xl z-50"><button id="clear-quiz-logs-btn">Quiz</button><button id="clear-lecture-logs-btn">Lec</button><button id="clear-all-logs-btn">All</button><button id="clear-log-cancel-btn">Cancel</button></div>
    <div id="announcements-modal" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded shadow-xl z-50 max-w-md w-full"><div id="announcements-list"></div><button id="announcements-close-btn" class="mt-4 w-full bg-slate-100 py-2">Close</button></div>
    <div id="messenger-modal" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded shadow-xl z-50 max-w-md w-full"><button id="messenger-close-btn" class="float-right">&times;</button><div id="messages-list" class="h-60 overflow-y-auto bg-slate-50 mb-4"></div><div class="flex gap-2"><input id="message-input" class="border flex-1"><button id="send-message-btn">Send</button></div><p id="messenger-error"></p></div>
    <div id="create-plan-modal" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded shadow-xl z-50"><input id="new-plan-name"><input id="new-plan-start-date" type="date"><input id="new-plan-end-date" type="date"><button id="confirm-create-plan-btn">Create</button><button id="cancel-create-plan-btn">Cancel</button><p id="create-plan-error"></p></div>
    <div id="osce-navigator-modal" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded shadow-xl z-50"><div id="osce-navigator-content"></div><button id="osce-navigator-close-btn">Close</button></div>
    <div id="onboarding-modal" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded shadow-xl z-50 text-center"><button id="start-tour-btn">Start</button><button id="skip-tour-btn">Skip</button></div>
    <div id="tour-tooltip" class="hidden fixed z-50 bg-white p-4 rounded shadow-xl border-l-4 border-blue-500 max-w-xs"><h3 id="tour-title" class="font-bold"></h3><p id="tour-text" class="text-sm my-2"></p><div class="flex justify-between items-center"><span id="tour-step-count" class="text-xs text-slate-400"></span><div><button id="tour-end-btn" class="text-xs mr-2">End</button><button id="tour-next-btn" class="bg-blue-600 text-white px-3 py-1 rounded text-xs">Next</button></div></div></div>
    <div id="ios-install-modal" class="hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white p-6 rounded shadow z-50"><button id="ios-install-close-btn">x</button></div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW fail', err));
            });
        }
    </script>

    <script type="module" src="js/main.js"></script>
    <script src="js/login-animation.js"></script>
</body>
</html>
